-- CREACIÓN DE SINÓNIMO PARA TABLA1

-- EN ESQUEMA DE TABLA1
GRANT SELECT ON TABLA TO ESQUEMA_QUE_USA_TABLA1

-- ESQUEMA QUE USA TABLA1
CREATE OR REPLACE SYNONYM "TABLA1" FOR "ESQUEMA_TABLA1"."TABLA1"




-- AÑADIR CAMPO A TABLA1

ALTER TABLE ESQUEMA.TABLA1
 ADD (NOMBRE_CAMPO TIPO(TAMAÑO));
 

-- CLAVE ÚNICA 

 ALTER TABLE ESQUEMA.TABLA1  ADD
CONSTRAINT TABLA__UN
  UNIQUE (CAMPO)
  USING INDEX ESQUEMA.TABLA1__UN
  ENABLE VALIDATE;

CREATE UNIQUE INDEX ESQUEMA.TABLA1 ON ESQUEMA.TABLA1
(CAMPO);



-- SECUENCIA PARA ID
CREATE SEQUENCE ESQUEMA.ID_SEQ
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  NOORDER;

-- TRIGGER ESQUEMA.ID AUTOINCREMENTO

CREATE OR REPLACE TRIGGER ESQUEMA.ID_TRG
BEFORE INSERT
ON ESQUEMA.TABLA1 REFERENCING NEW AS New OLD AS Old
FOR EACH ROW
DECLARE
ID     NUMBER;

BEGIN
   ID := :NEW.CAMPO_ID;

   IF (ID IS NULL) OR (ID=(-1)) THEN
      SELECT ESQUEMA.ID_SEQ.NEXTVAL INTO ID FROM dual;
      :NEW.CAMPO_ID := ID;
   END IF;
   
   EXCEPTION
     WHEN OTHERS THEN
       -- Consider logging the error and then re-raise
       RAISE;

END CAMBIO_ID_TRG;
/


 
-- CREAR NUEVA TABLA 

CREATE TABLE ESQUEMA.TABLA2
(
  CAMPO         TIPO,
  CAMPO1       TIPO(TAMAÑO BYTE/..)

);


--CLAVE PRIMARIA

CREATE UNIQUE INDEX ESQUEMA.TABLA_PK ON ESQUEMA.TABLA
(CAMPO);
 

ALTER TABLE ESQUEMA.TABLA ADD (
  CONSTRAINT HOR_DOC_FIRMAS_PK
  PRIMARY KEY
  (CAMPO)
  USING INDEX HORMONA.TABLA_PK
  ENABLE VALIDATE);

-- CLAVE SECUNDARIA

ALTER TABLE ESQUEMA.TABLA ADD (
  CONSTRAINT TABLA_TABLA2_FK 
  FOREIGN KEY (CAMPO) 
  REFERENCES ESQUEMA.TABLA2 (CAMPO)
  ENABLE VALIDATE);

 


